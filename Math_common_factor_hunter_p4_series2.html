<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Kru Pai Classroom ¬∑ ‡πÄ‡∏Å‡∏°‡∏•‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏° ¬∑ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 2</title>
<style>
  :root{
    --bg:#f5fffb;
    --panel:#ffffff;
    --ink:#174233;
    --muted:#5f7b71;
    --accent:#45d19b;
    --accent-soft:#a5f7cf;
    --ok:#00b894;
    --bad:#e84365;
    --shadow:0 12px 30px rgba(0,0,0,.08);
  }

  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
  html,body{
    margin:0;
    height:100%;
    font-family:"Prompt",system-ui,-apple-system,"Segoe UI",sans-serif;
    background:var(--bg);
    color:var(--ink);
  }

  header{
    position:sticky;
    top:0;
    z-index:5;
    background:linear-gradient(120deg,#e3fff2,#fdfdfd);
    border-bottom:2px solid rgba(120,220,170,.7);
    padding:10px 14px;
    box-shadow:0 6px 20px rgba(0,0,0,.05);
  }
  .brand{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    font-weight:900;
    letter-spacing:.35px;
    font-size:clamp(17px,5vw,21px);
  }
  .brand span:first-child{
    display:flex;
    align-items:center;
    gap:6px;
  }
  .brand-emoji{font-size:20px;}
  .badge{
    font-size:11px;
    font-weight:900;
    padding:4px 10px;
    border-radius:999px;
    background:#ffffff;
    color:#0c9b65;
    border:1px solid rgba(120,220,170,.7);
    box-shadow:0 0 0 2px rgba(255,255,255,.7);
  }

  main{
    max-width:960px;
    margin:0 auto;
    padding:16px;
  }

  .card{
    background:var(--panel);
    border-radius:22px;
    border:1.5px solid #d9f5e7;
    box-shadow:var(--shadow);
    padding:18px;
    margin:12px 0;
    position:relative;
    overflow:hidden;
  }
  .card::before{
    content:"";
    position:absolute;
    inset:-40px;
    background:
      repeating-linear-gradient(90deg, #dff6ea 0, #dff6ea 1px, transparent 1px, transparent 26px),
      repeating-linear-gradient(#dff6ea 0, #dff6ea 1px, transparent 1px, transparent 26px),
      radial-gradient(circle at 0% 0%, rgba(187,245,210,.6), transparent 55%),
      radial-gradient(circle at 100% 120%, rgba(205,238,255,.6), transparent 55%);
    opacity:.55;
    pointer-events:none;
    z-index:-1;
  }

  .title{
    font-size:clamp(22px,6vw,30px);
    font-weight:900;
    display:flex;
    align-items:center;
    gap:6px;
  }
  .title-emoji{font-size:26px;}
  .sub{
    color:var(--muted);
    font-size:14px;
    line-height:1.5;
  }

  .row{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
    margin-top:10px;
  }

  .input{
    flex:1;
    min-width:180px;
    border-radius:14px;
    border:1.5px solid #c6ebda;
    padding:10px 12px;
    background:#ffffff;
    color:var(--ink);
    font-weight:800;
    outline:none;
  }
  .input::placeholder{color:#9cbba9;}
  .input:focus{
    box-shadow:0 0 0 3px rgba(140,235,190,.8);
    border-color:var(--accent);
  }

  .pill{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 10px;
    border-radius:999px;
    background:#ffffff;
    border:1.5px solid #d4efe0;
    font-size:12px;
    font-weight:800;
    color:var(--muted);
  }
  .pill b{color:#21aa71;}
  .pill-emoji{font-size:14px;}

  .btn{
    border:0;
    border-radius:16px;
    padding:12px 16px;
    font-weight:900;
    cursor:pointer;
    min-width:150px;
    font-size:15px;
    box-shadow:0 10px 24px rgba(0,0,0,.12);
    transition:transform .08s ease, box-shadow .12s ease, filter .12s ease, background .15s ease;
  }
  .btn:active{transform:translateY(1px);box-shadow:0 6px 16px rgba(0,0,0,.14);}
  .btn.primary{
    background:linear-gradient(120deg,#45d19b,#9cf0d3);
    color:#083627;
  }
  .btn.alt{
    background:#ffffff;
    border:1.5px solid #cde8dd;
    color:var(--ink);
  }
  .btn.disabled{
    opacity:.4;
    pointer-events:none;
    box-shadow:none;
  }

  .game-area{
    margin-top:14px;
    border-radius:20px;
    border:1.5px solid #d9f3e8;
    background:#fdfefc;
    box-shadow:0 14px 30px rgba(0,0,0,.06);
    padding:14px;
  }

  .mission{
    font-size:14px;
    font-weight:800;
    color:#18885a;
    margin-bottom:8px;
    display:flex;
    align-items:center;
    gap:6px;
  }
  .mission-emoji{font-size:18px;}

  .board{
    margin-top:8px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:12px;
    border-radius:18px;
    background:
      repeating-linear-gradient(90deg, #dff6ea 0, #dff6ea 1px, transparent 1px, transparent 26px),
      repeating-linear-gradient(#dff6ea 0, #dff6ea 1px, transparent 1px, transparent 26px),
      #f9fffb;
  }

  .question-label{
    font-size:13px;
    font-weight:800;
    color:#2c6b4e;
    margin-bottom:4px;
    text-align:center;
  }

  .numbers-pair{
    font-size:clamp(30px,6vw,40px);
    font-weight:900;
    margin-bottom:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:12px;
  }
  .num-box{
    min-width:70px;
    text-align:center;
    padding:6px 10px;
    border-radius:16px;
    background:#ffffff;
    border:2px solid #9de6c2;
    box-shadow:0 4px 10px rgba(0,0,0,.04);
  }
  .and-sign{
    font-size:clamp(22px,5vw,28px);
  }

  .info-text{
    font-size:13px;
    color:#3c8161;
    font-weight:800;
    margin-bottom:6px;
    text-align:center;
  }

  .answer-wrap{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    margin-bottom:6px;
  }
  .answer-row{
    display:flex;
    gap:8px;
    justify-content:center;
    flex-wrap:wrap;
  }

  .factor-input{
    width:80px;
    max-width:24vw;
    height:46px;
    border-radius:14px;
    border:3px solid #ff99c8;
    background:#ffe6f2;
    text-align:center;
    font-size:clamp(20px,5.5vw,26px);
    font-weight:900;
    color:#af1048;
    outline:none;
    box-shadow:0 0 8px rgba(255,153,200,.35);
  }
  .factor-input.active{
    border-color:#ff6fb3;
    box-shadow:0 0 0 3px rgba(255,183,220,.9);
  }
  .factor-input[readonly]{
    caret-color:transparent;
  }
  .factor-input.hidden{
    display:none;
  }

  .numpad{
    margin-top:4px;
    display:grid;
    grid-template-columns:repeat(4, minmax(0,1fr));
    gap:6px;
    max-width:280px;
  }
  .numpad-btn{
    border-radius:14px;
    border:1.5px solid #ffd1e8;
    background:#fff5fb;
    padding:8px 0;
    font-size:18px;
    font-weight:900;
    color:#c0185b;
    text-align:center;
    cursor:pointer;
    box-shadow:0 4px 10px rgba(0,0,0,.06);
    user-select:none;
  }
  .numpad-btn.fn{
    font-size:13px;
    color:#8a2650;
    background:#ffe0f1;
  }
  .numpad-btn:active{
    transform:translateY(1px);
    box-shadow:0 2px 6px rgba(0,0,0,.12);
  }

  .status-text{
    margin-top:8px;
    font-size:13px;
    min-height:24px;
    text-align:center;
  }
  .status-text.ok{color:#0c9b65;font-weight:800;}
  .status-text.bad{color:#c81f45;font-weight:800;}

  .footer-nav{
    margin-top:12px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
  }
  .footer-nav .btn{flex:1;}

  .center{text-align:center;}
  .big{
    font-size:clamp(24px,7vw,36px);
    font-weight:900;
  }
  .big-emoji{
    font-size:30px;
    display:block;
    margin-bottom:6px;
  }
  .hidden{display:none!important;}

  .glitter{
    position:fixed;
    pointer-events:none;
    font-size:24px;
    animation:glitterPop 900ms ease-out forwards;
    filter:drop-shadow(0 0 6px rgba(200,255,220,.9));
    z-index:9999;
  }
  @keyframes glitterPop{
    0%{transform:translateY(0) scale(.9);opacity:1;}
    100%{transform:translateY(-60px) scale(1.25);opacity:0;}
  }

  .shake{
    animation:shake 0.35s ease-out;
  }
  @keyframes shake{
    0%{transform:translateX(0);}
    25%{transform:translateX(-4px);}
    50%{transform:translateX(4px);}
    75%{transform:translateX(-3px);}
    100%{transform:translateX(0);}
  }

  .pulse{
    animation:pulse 0.5s ease-out;
  }
  @keyframes pulse{
    0%{transform:scale(1);}
    50%{transform:scale(1.06);}
    100%{transform:scale(1);}
  }

  @media (min-width:1024px){
    body{font-size:18px;}
    .factor-input{
      width:90px;
      height:50px;
      font-size:26px;
    }
  }
</style>
</head>
<body>

<header>
  <div class="brand">
    <span>
      <span class="brand-emoji">üîç</span>
      Kru Pai Classroom ¬∑ ‡πÄ‡∏Å‡∏°‡∏•‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°
    </span>
    <span class="badge">Common Factor Hunter ¬∑ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 2 ¬∑ 20 ‡∏Ç‡πâ‡∏≠</span>
  </div>
</header>

<main>
  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° -->
  <section id="startScreen" class="card">
    <div class="title">
      <span class="title-emoji">üß†</span>
      ‡∏•‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏° ¬∑ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 2
    </div>
    <p class="sub">
      ‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏Ñ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 20 ‡∏Ç‡πâ‡∏≠<br><br>
      <b>‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤:</b><br>
      ‚Ä¢ ‡∏°‡∏≠‡∏á‡∏î‡∏π‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß ‡πÄ‡∏ä‡πà‡∏ô <b>30</b> ‡πÅ‡∏•‡∏∞ <b>36</b><br>
      ‚Ä¢ ‡πÄ‡∏ï‡∏¥‡∏° ‚Äú‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1‚Äù ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß ‡πÄ‡∏ä‡πà‡∏ô 2, 3, 6 ‚úÖ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà 1)<br>
      ‚Ä¢ ‡∏ö‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏° 1 ‡∏ï‡∏±‡∏ß, ‡∏ö‡∏≤‡∏á‡∏Ç‡πâ‡∏≠ 2‚Äì3 ‡∏ï‡∏±‡∏ß<br>
      ‚Ä¢ ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‚ûú <b>+2 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</b><br>
      ‚Ä¢ ‡∏ú‡∏¥‡∏î‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å ‡πÅ‡∏ï‡πà‡πÅ‡∏Å‡πâ‡∏ñ‡∏π‡∏Å ‚ûú <b>+1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</b><br>
      ‚Ä¢ ‡∏ú‡∏¥‡∏î 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚ûú ‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢‡πÑ‡∏î‡πâ (‡∏Ç‡πâ‡∏≠‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏ö‡∏ß‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô) <br>
      ‚Ä¢ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>20 ‡∏Ç‡πâ‡∏≠</b> ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 1 ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äú‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≥‚Äù ‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏ï‡πá‡∏° ‚ú®
    </p>
    <div class="row">
      <input id="playerName" class="input" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô Pond, Dear, Nam üßë‚Äçüéì">
    </div>
    <div class="row" style="margin-top:12px">
      <button id="btnStart" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1/20 ‚ñ∂</button>
    </div>
  </section>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏° -->
  <section id="gameScreen" class="card hidden">
    <div class="row">
      <span class="pill"><span class="pill-emoji">üëß</span>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: <b id="displayName">-</b></span>
      <span class="pill"><span class="pill-emoji">üìå</span>‡∏Ç‡πâ‡∏≠: <b id="qIndex">1 / 20</b></span>
      <span class="pill"><span class="pill-emoji">‚≠ê</span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <b id="score">0</b></span>
      <span class="pill"><span class="pill-emoji">‚úÖ</span>‡∏ñ‡∏π‡∏Å: <b id="correctCount">0</b></span>
      <span class="pill"><span class="pill-emoji">‚ùå</span>‡∏û‡∏•‡∏≤‡∏î: <b id="wrongCount">0</b></span>
    </div>

    <div class="game-area">
      <div class="mission">
        <span class="mission-emoji">üéØ</span>
        <span>‡πÄ‡∏ï‡∏¥‡∏° ‚Äú‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1‚Äù ‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß</span>
      </div>

      <div class="board" id="board">
        <div class="question-label" id="questionLabel">
          ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1: ‡∏à‡∏á‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô 1)
        </div>

        <div class="numbers-pair">
          <div class="num-box" id="numA">30</div>
          <span class="and-sign">‡πÅ‡∏•‡∏∞</span>
          <div class="num-box" id="numB">36</div>
        </div>

        <div class="info-text" id="infoSlots">
          ‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>3 ‡∏ï‡∏±‡∏ß</b> (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1) ‚úçÔ∏è
        </div>

        <div class="answer-wrap">
          <div class="answer-row">
            <input type="text" id="factor1" class="factor-input" readonly>
            <input type="text" id="factor2" class="factor-input" readonly>
            <input type="text" id="factor3" class="factor-input" readonly>
          </div>
        </div>

        <div class="info-text">
          ‡πÅ‡∏ï‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏¥‡πâ‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å‡πÅ‡∏õ‡πâ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡∏•‡∏ö‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏ú‡∏¥‡∏î) üòä
        </div>

        <div class="numpad" id="numpad">
          <div class="numpad-btn" data-key="7">7</div>
          <div class="numpad-btn" data-key="8">8</div>
          <div class="numpad-btn" data-key="9">9</div>
          <div class="numpad-btn fn" data-key="del">‚å´</div>

          <div class="numpad-btn" data-key="4">4</div>
          <div class="numpad-btn" data-key="5">5</div>
          <div class="numpad-btn" data-key="6">6</div>
          <div class="numpad-btn fn" data-key="clear">‡∏•‡∏ö‡∏´‡∏°‡∏î</div>

          <div class="numpad-btn" data-key="1">1</div>
          <div class="numpad-btn" data-key="2">2</div>
          <div class="numpad-btn" data-key="3">3</div>
          <div class="numpad-btn" data-key="0">0</div>
        </div>

        <div class="status-text" id="status"></div>
      </div>

      <div class="footer-nav">
        <button id="btnCheck" class="btn primary">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‚úÖ</button>
        <button id="btnShowAns" class="btn alt disabled">‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢ üëÄ</button>
        <button id="btnNext" class="btn alt disabled">‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>
      </div>
    </div>
  </section>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ -->
  <section id="summaryScreen" class="card hidden center">
    <div class="title">
      <span class="title-emoji">üèÅ</span>
      ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• Common Factor Hunter ¬∑ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 2
    </div>
    <div class="big">
      <span class="big-emoji" id="sumEmoji">üéâ</span>
      <span id="sumScore">0 / 40 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
    </div>
    <p class="sub" id="sumDetail"></p>
    <p class="sub" id="sumComment"></p>
    <div class="footer-nav">
      <button id="btnReplay" class="btn primary">‡πÄ‡∏•‡πà‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á üîÅ</button>
      <button id="btnBackHome" class="btn alt">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å üè°</button>
    </div>
  </section>
</main>

<script>
let audioCtx;
function beep(freq=760, dur=0.08, type="sine", gain=0.04){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g);
    g.connect(audioCtx.destination);
    o.start();
    setTimeout(()=>{o.stop(); o.disconnect(); g.disconnect();}, dur*1000);
  }catch(e){}
}
function okSound(){
  beep(1040,0.07,"triangle",0.06);
  setTimeout(()=>beep(1500,0.09,"triangle",0.05),90);
}
function badSound(){
  beep(250,0.16,"sawtooth",0.07);
}

function glitter(x,y,good=true){
  const g = document.createElement("div");
  g.className = "glitter";
  g.textContent = good ? "‚ú®" : "üí•";
  g.style.left = (x-10) + "px";
  g.style.top = (y-10) + "px";
  document.body.appendChild(g);
  setTimeout(()=>g.remove(), 900);
}

const $ = id => document.getElementById(id);

const E = {
  start: $("startScreen"),
  game: $("gameScreen"),
  summary: $("summaryScreen"),
  nameInput: $("playerName"),
  btnStart: $("btnStart"),
  displayName: $("displayName"),
  qIndex: $("qIndex"),
  score: $("score"),
  correctCount: $("correctCount"),
  wrongCount: $("wrongCount"),
  numA: $("numA"),
  numB: $("numB"),
  questionLabel: $("questionLabel"),
  infoSlots: $("infoSlots"),
  status: $("status"),
  board: $("board"),
  btnCheck: $("btnCheck"),
  btnShowAns: $("btnShowAns"),
  btnNext: $("btnNext"),
  sumEmoji: $("sumEmoji"),
  sumScore: $("sumScore"),
  sumDetail: $("sumDetail"),
  sumComment: $("sumComment"),
  btnReplay: $("btnReplay"),
  btnBackHome: $("btnBackHome"),
  numpad: $("numpad"),
  factorInputs: [
    $("factor1"),
    $("factor2"),
    $("factor3")
  ]
};

/* ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 2: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏´‡∏•‡∏±‡∏Å ‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏° 1‚Äì3 ‡∏ï‡∏±‡∏ß */
const QUESTIONS = [
  {a:12,b:20,factors:[2,4]},
  {a:18,b:24,factors:[2,3,6]},
  {a:30,b:36,factors:[2,3,6]},
  {a:45,b:60,factors:[3,5,15]},
  {a:16,b:28,factors:[2,4]},
  {a:21,b:35,factors:[7]},
  {a:27,b:45,factors:[3,9]},
  {a:14,b:22,factors:[2]},
  {a:25,b:40,factors:[5]},
  {a:33,b:55,factors:[11]},
  {a:18,b:30,factors:[2,3,6]},
  {a:22,b:26,factors:[2]},
  {a:24,b:40,factors:[2,4,8]},
  {a:28,b:36,factors:[2,4]},
  {a:15,b:45,factors:[3,5,15]},
  {a:42,b:70,factors:[2,7,14]},
  {a:16,b:24,factors:[2,4,8]},
  {a:27,b:63,factors:[3,9]},
  {a:10,b:20,factors:[2,5,10]},
  {a:12,b:18,factors:[2,3,6]}
];

let currentIndex = 0;
let score = 0;
let correctCount = 0;
let wrongCount = 0;
let attempts = 0;
let answered = false;

let activeInput = null;

function setActiveInput(el){
  if(activeInput === el) return;
  E.factorInputs.forEach(inp=>inp.classList.remove("active"));
  activeInput = el;
  if(activeInput){
    activeInput.classList.add("active");
  }
}

function clearInputs(){
  E.factorInputs.forEach(inp=>{
    inp.value = "";
    inp.disabled = false;
  });
}

function setupSlots(){
  const q = QUESTIONS[currentIndex];
  const need = q.factors.length;
  E.infoSlots.innerHTML = `‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>${need} ‡∏ï‡∏±‡∏ß</b> (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1) ‚úçÔ∏è`;
  E.factorInputs.forEach((inp,idx)=>{
    if(idx < need){
      inp.classList.remove("hidden");
      inp.value = "";
      inp.disabled = false;
    }else{
      inp.classList.add("hidden");
      inp.value = "";
      inp.disabled = true;
    }
  });
}

function loadQuestion(){
  const q = QUESTIONS[currentIndex];
  const qNo = currentIndex + 1;

  E.qIndex.textContent = qNo + " / " + QUESTIONS.length;
  E.questionLabel.textContent =
    "‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà " + qNo + ": ‡∏à‡∏á‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)";
  E.numA.textContent = q.a;
  E.numB.textContent = q.b;

  attempts = 0;
  answered = false;
  E.status.textContent = "";
  E.status.className = "status-text";

  E.btnCheck.classList.remove("disabled");
  E.btnShowAns.classList.add("disabled");
  E.btnNext.classList.add("disabled");

  setupSlots();

  E.board.classList.remove("shake","pulse");
  setTimeout(()=>{
    E.board.classList.add("pulse");
    setTimeout(()=>E.board.classList.remove("pulse"), 500);
  },30);

  setActiveInput(E.factorInputs[0]);
}

function getUserFactors(){
  const q = QUESTIONS[currentIndex];
  const need = q.factors.length;
  const values = [];
  const used = new Set();

  for(let i=0;i<need;i++){
    const inp = E.factorInputs[i];
    let v = parseInt(inp.value,10);
    if(!v || v <= 1){
      return {ok:false,reason:"empty_or_invalid",values:[]};
    }
    if(used.has(v)){
      return {ok:false,reason:"duplicate",values:[]};
    }
    used.add(v);
    values.push(v);
  }
  return {ok:true,values};
}

function checkAnswer(evt){
  if(E.btnCheck.classList.contains("disabled")) return;
  const rect = evt && evt.clientX ? {x:evt.clientX,y:evt.clientY} : null;
  attempts++;

  const user = getUserFactors();
  if(!user.ok){
    if(user.reason === "empty_or_invalid"){
      E.status.textContent = "‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏ô‡∏∞ üòä";
    }else if(user.reason === "duplicate"){
      E.status.textContent = "‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏∞ üå±";
    }else{
      E.status.textContent = "‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡∏∞‡∏à‡πä‡∏∞ ‚ú®";
    }
    E.status.className = "status-text bad";
    E.board.classList.add("shake");
    setTimeout(()=>E.board.classList.remove("shake"), 360);
    badSound();
    return;
  }

  const q = QUESTIONS[currentIndex];
  const expected = q.factors.slice().sort((a,b)=>a-b);
  const userSorted = user.values.slice().sort((a,b)=>a-b);

  let correct = expected.length === userSorted.length;
  if(correct){
    for(let i=0;i<expected.length;i++){
      if(expected[i] !== userSorted[i]){
        correct = false;
        break;
      }
    }
  }

  if(!correct){
    wrongCount++;
    E.wrongCount.textContent = wrongCount;
    if(attempts === 1){
      E.status.textContent =
        "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß ‡∏•‡∏≠‡∏á‡πÑ‡∏•‡πà‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á " + q.a + " ‡πÅ‡∏•‡∏∞ " + q.b + " ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡∏î‡∏π‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ô‡∏∞ üîç";
    }else if(attempts === 2){
      E.status.textContent =
        "‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÉ‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏° ‡∏•‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß 2,3,5,7 ‡∏î‡∏π‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á üåø";
    }else{
      E.status.textContent =
        "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏î‡∏µ (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß ‡∏Å‡∏î‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üëÄ) ";
    }
    E.status.className = "status-text bad";
    E.board.classList.add("shake");
    setTimeout(()=>E.board.classList.remove("shake"), 360);
    badSound();

    if(!answered && attempts >= 3){
      E.btnShowAns.classList.remove("disabled");
    }
    return;
  }

  let addScore = 0;
  if(attempts === 1) addScore = 2;
  else if(attempts === 2) addScore = 1;

  score += addScore;
  correctCount++;
  E.score.textContent = score;
  E.correctCount.textContent = correctCount;

  E.status.textContent = addScore === 2
    ? "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡πÄ‡∏à‡∏≠‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡πÑ‡∏î‡πâ +2 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‚ú®"
    : (addScore === 1
        ? "‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πâ‡∏≤! ‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡∏´‡∏≤‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏î‡πâ +1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏•‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏î‡∏π‡∏ô‡∏∞ üåü"
        : "‡∏ñ‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ö‡∏ß‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏ï‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß üíö");
  E.status.className = "status-text ok";

  E.factorInputs.forEach(inp=>inp.disabled = true);
  E.btnCheck.classList.add("disabled");
  E.btnShowAns.classList.add("disabled");
  E.btnNext.classList.remove("disabled");
  answered = true;

  okSound();
  const x = rect ? rect.x : window.innerWidth/2;
  const y = rect ? rect.y : window.innerHeight/2;
  glitter(x,y,true);
  E.board.classList.add("pulse");
  setTimeout(()=>E.board.classList.remove("pulse"), 500);
}

function showAnswer(){
  if(E.btnShowAns.classListContains && E.btnShowAns.classList.contains("disabled")) return;
  if(E.btnShowAns.classList && E.btnShowAns.classList.contains("disabled")) return;
}

function showAnswer(){
  if(E.btnShowAns.classList.contains("disabled")) return;
  const q = QUESTIONS[currentIndex];
  const expected = q.factors.slice().sort((a,b)=>a-b);

  for(let i=0;i<E.factorInputs.length;i++){
    if(i < expected.length){
      E.factorInputs[i].value = expected[i];
    }else{
      E.factorInputs[i].value = "";
    }
    E.factorInputs[i].disabled = true;
  }

  E.status.textContent =
    "‡πÄ‡∏â‡∏•‡∏¢: ‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á " + q.a + " ‡πÅ‡∏•‡∏∞ " + q.b + " (‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1) ‡∏Ñ‡∏∑‡∏≠ " + expected.join(", ") + " ‚ú®";
  E.status.className = "status-text ok";

  E.btnCheck.classList.add("disabled");
  E.btnShowAns.classList.add("disabled");
  E.btnNext.classList.remove("disabled");

  okSound();
  glitter(window.innerWidth/2, window.innerHeight/2, true);
}

function nextQuestion(){
  if(E.btnNext.classList.contains("disabled")) return;
  if(currentIndex < QUESTIONS.length - 1){
    currentIndex++;
    loadQuestion();
  }else{
    endGame();
  }
}

function endGame(){
  E.game.classList.add("hidden");
  E.summary.classList.remove("hidden");

  const maxScore = QUESTIONS.length * 2;
  E.sumScore.textContent = score + " / " + maxScore + " ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";

  const name = (E.displayName.textContent || "‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô").trim();
  E.sumDetail.textContent =
    "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: " + name + " ¬∑ ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å " + correctCount + " ‡∏Ç‡πâ‡∏≠ ¬∑ ‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏≤‡∏î " + wrongCount + " ‡∏Ñ‡∏£‡∏±‡πâ‡∏á";

  let comment = "";
  let emoji = "üéâ";
  const ratio = score / maxScore;

  if(ratio >= 0.85){
    comment = "‡πÇ‡∏´‡∏î‡∏°‡∏≤‡∏Å! ‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 2 ‡πÑ‡∏î‡πâ‡πÅ‡∏£‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 1 ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÑ‡∏õ‡πÄ‡∏Å‡∏°‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≥‡∏à‡∏∞‡πÇ‡∏ö‡∏¢‡∏ö‡∏¥‡∏ô‡πÄ‡∏•‡∏¢ üíö";
    emoji = "üèÜ";
  }else if(ratio >= 0.6){
    comment = "‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏ê‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏ô‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå 1 + 2 ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≥ ‡∏à‡∏∞‡∏¢‡∏¥‡πà‡∏á‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô üåü";
    emoji = "‚≠ê";
  }else if(ratio >= 0.3){
    comment = "‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≠‡∏°‡∏•‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ä‡πà‡∏ß‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üå±";
    emoji = "üòä";
  }else{
    comment = "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡πÄ‡∏•‡∏¢ ‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ù‡∏∂‡∏Å‡∏™‡∏≤‡∏¢‡∏™‡∏∑‡∏ö‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏£ ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô pre-test ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏£‡∏≠‡∏ö‡∏™‡∏≠‡∏á‡πÑ‡∏î‡πâ üí™";
    emoji = "üí™";
  }

  E.sumComment.textContent = comment;
  E.sumEmoji.textContent = emoji;
}

E.btnStart.addEventListener("click", ()=>{
  const name = (E.nameInput.value || "Player").trim().slice(0,24);
  E.displayName.textContent = name || "Player";

  currentIndex = 0;
  score = 0;
  correctCount = 0;
  wrongCount = 0;

  E.score.textContent = "0";
  E.correctCount.textContent = "0";
  E.wrongCount.textContent = "0";

  E.start.classList.add("hidden");
  E.summary.classList.add("hidden");
  E.game.classList.remove("hidden");

  audioCtx = null;
  loadQuestion();
});

E.btnCheck.addEventListener("click", (e)=>checkAnswer(e));
E.btnShowAns.addEventListener("click", showAnswer);
E.btnNext.addEventListener("click", nextQuestion);

E.btnReplay.addEventListener("click", ()=>{
  currentIndex = 0;
  score = 0;
  correctCount = 0;
  wrongCount = 0;

  E.score.textContent = "0";
  E.correctCount.textContent = "0";
  E.wrongCount.textContent = "0";

  E.summary.classList.add("hidden");
  E.game.classList.remove("hidden");
  loadQuestion();
});

E.btnBackHome.addEventListener("click", ()=>{
  E.summary.classList.add("hidden");
  E.start.classList.remove("hidden");
});

E.factorInputs.forEach((inp)=>{
  inp.addEventListener("click", ()=>setActiveInput(inp));
});

if(E.numpad){
  E.numpad.addEventListener("click", e=>{
    const btn = e.target.closest(".numpad-btn");
    if(!btn) return;
    if(!activeInput || activeInput.disabled) return;

    const key = btn.dataset.key;
    let val = activeInput.value || "";

    if(key === "del"){
      activeInput.value = val.slice(0,-1);
    }else if(key === "clear"){
      activeInput.value = "";
    }else{
      if(val.length >= 2) return;
      if(val === "0"){
        activeInput.value = key;
      }else{
        activeInput.value = val + key;
      }
    }
  });
}

setActiveInput(E.factorInputs[0]);
</script>
</body>
</html>
